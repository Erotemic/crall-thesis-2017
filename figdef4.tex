%\edef\pzcode{PZ_PB_RF_TRAIN_2567}
%\edef\gzcode{GZ_Master1_21589}
%%\edef\gzcode{GZ_Master1_222}


%\newcommand{\PairFeatVec}{
%\begin{figure}
%\begin{minted}[gobble=4]{python}
%    OrderedDict([('global(qual_min)',    3),
%                 ('global(qual_max)',    nan),
%                 ('global(qual_delta)',  nan),
%                 ('global(gps_delta)',   5.79),
%                 ('len(matches)',        20),
%                 ('sum(ratio)',          10.05),
%                 ('mean(ratio)',         0.50),
%                 ('std(ratio)',          0.09)])
%\end{minted}
%\caption[\caplbl{PairFeatVec}A pairwise feature vector]{\caplbl{PairFeatVec} %
%Example of a small pairwise feature vector containing local and global information.
%In practice the pairwise feature vectors include many more dimensions.
%}
%\label{fig:PairFeatVec}
%\end{figure}
%}

\newcommand{\PairDBStats}{
\begin{table}[b]
    \centering
    \caption[\caplbl{PairDBStats}Database statistics for the pairwise experiment]{\caplbl{PairDBStats}
    % ---
    Database statistics for the pairwise experiment.
    Starting with a database of annotations with name labels, we sample a set of annotation pairs to evaluate our
      pairwise classifiers with.
    % ---
    }
    \label{tbl:PairDBStats}
    \begin{tabular}{lrrrrrr}
    \toprule
           Database & {Names} & {Annots} & {Positive} & {Negative} & {Incomparable} & {Photobombs} \\
    \midrule
      plains zebras &            1202 &             5720 &   16583   & 30376    & 353  & 286 \\
     Grévy's zebras &             771 &             2283 &   5002    & 13008    & 0    & 76  \\
    \bottomrule
    \end{tabular}
\end{table}
}


\newcommand{\MatchStateExample}{
\begin{figure}[h] \centering
\begin{subfigure}[h]{0.26\textwidth}\centering\includegraphics[height=160pt]{figures4/classesC.png}\caption{positive}\label{sub:classesC}\end{subfigure}
\begin{subfigure}[h]{0.31\textwidth}\centering\includegraphics[height=160pt]{figures4/classesA.png}\caption{negative}\label{sub:classesA}\end{subfigure}
\begin{subfigure}[h]{0.31\textwidth}\centering\includegraphics[height=160pt]{figures4/classesB.png}\caption{incomparable}\label{sub:classesB}\end{subfigure}
\caption[\caplbl{MatchStateExample}Match-state example]{\caplbl{MatchStateExample}
% ---
Examples of positive \cref{sub:classesC}, negative  \cref{sub:classesA}, and incomparable \cref{sub:classesB}
pairs of annotations. Local feature correspondences are superimposed over the pairs.
% ---
}
\label{fig:MatchStateExample}
\end{figure}
}


\newcommand{\LeftRightFace}{
\begin{figure}[h]
\centering
\includegraphics[width=\textwidth]{figures4/custom_match_leftrightface_5245_5161.jpg}
\caption[\caplbl{LeftRightFace}A comparable pair with different viewpoints]{\caplbl{LeftRightFace}
% ---
Even though this pair has different viewpoints, it is positive and comparable
because we can establish a distinctive correspondence in the face. 
% ---
}
\label{fig:LeftRightFace}
\end{figure}
}


% -------------------
% --- Experiments ---
% -------------------

\begin{comment}
    python -m ibeis Chap4.measure_all --db PZ_PB_RF_TRAIN
    python -m ibeis Chap4.measure_all --db GZ_Master1 && python -m ibeis Chap4.measure_all --db PZ_Master1
    python -m ibeis Chap4.measure_all --db PZ_MTEST

    python -m ibeis Chap4.draw_all --db PZ_MTEST
    python -m ibeis Chap4.draw_all --db PZ_Master1
    python -m ibeis Chap4.draw_all --db GZ_Master1
\end{comment}


\newcommand{\PositiveHist}{
\begin{figure}[h]
\centering
\begin{subfigure}[h]{0.47\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/score_hist_lnbnn.png}\caption{Plains zebras LNBNN}\label{sub:pos_lnbnn_hist_pz}\end{subfigure}
\begin{subfigure}[h]{0.47\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/score_hist_pos_learn(sum,glob).png}\caption{Plains zebras learned}\label{sub:pos_hist_pz}\end{subfigure}
\begin{subfigure}[h]{0.47\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/score_hist_lnbnn.png}\caption{Grévy's zebras LNBNN}\label{sub:pos_lnbnn_hist_gz}\end{subfigure}
\begin{subfigure}[h]{0.47\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/score_hist_pos_learn(sum,glob).png}\caption{Grévy's zebras learned}\label{sub:pos_hist_gz} \end{subfigure}
%~
\caption[\caplbl{PositiveHist}Positive score histogram experiment]{\caplbl{PositiveHist}
% ---
Positive scores of LNBNN (left) and the pairwise algorithm (right) for pairs of plains (top) and Grévy's (bottom)
  zebras.
The learned probabilities are more separable and more interpretable than LNBNN scores.
%In addition to being more interpretable than LNBNN scores the learned probabilities exhibit better separability.
Note that in this plot, negative refers to annotation pairs with a non-positive match-state label.
% ---
}
\label{fig:PositiveHist}
\end{figure}
}



\newcommand{\PositiveROC}{
\begin{figure}[h]
\centering
\begin{subfigure}[h]{0.47\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/roc_match_state.png}\caption{Plains zebra}\end{subfigure}
\begin{subfigure}[h]{0.47\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/roc_match_state.png}\caption{Grévy's zebra}\end{subfigure}
\caption[\caplbl{PositiveROC}Positive match-state ROC experiment]{\caplbl{PositiveROC}
% ---
The positive match-state ROC for scores computed by the pairwise classifier and LNBNN.
The pairwise classifier significantly improves the separation of positive and non-positive pairs.
%The scores from the pairwise classifier are better at separating positive and non-positive cases.
%Additionally, operating points exist where the true positive rate is high and
%the false positive rate is near zero.
%can be selected to automatically review a significant number of positive cases
%  while making only a few errors.
% ---
}
\label{fig:PositiveROC}
\end{figure}
}


\newcommand{\ReRank}{
\begin{figure}[h]
\centering
\begin{subfigure}[h]{\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/rerank.png}\caption{Plains zebra}\end{subfigure}
\begin{subfigure}[h]{\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/rerank.png}\caption{Grévy's zebra}\end{subfigure}
\caption[\caplbl{ReRank}Re-ranking experiment]{\caplbl{ReRank}
% ---
Re-ranking the top LNBNN results using the positive probabilities from the match-state classifier improves the
  number of correct matches at rank $1$ for both plains and Grévy's zebra.
% ---
}
\label{fig:ReRank}
\end{figure}
}


\begin{comment}
    python -m ibeis.scripts.thesis ExptChapter4.write_metrics --db GZ_Master1 --task-key=match_state
    python -m ibeis.scripts.thesis ExptChapter4.write_metrics --db PZ_Master1 --task-key=match_state
\end{comment}
\newcommand{\ConfusionMatch}{
\begin{table}[b]
    \centering
    \caption[\caplbl{ConfusionMatch}Match-state experiment confusion matrix]{\caplbl{ConfusionMatch}
    % ---
    Multiclass match-state confusion for plains and Grévy's zebras.
    The rows are the real (groundtruth) state, and the columns are the predicted states.
    %The final column indicates the number of examples for each class.
    %A pair is classified as the state (positive, negative, or incomparable) with the maximum predicted
    %  probability.
    Each pair is classified as positive, negative, or incomparable depending on which state has the maximum
      probability.
    % ---
    }
    \label{tbl:ConfusionMatch}
    \begin{subtable}[h]{\textwidth}\centering\input{figures4/PZ_Master1/confusion_match_state.tex}\caption{Plains zebras match-state confusion matrix}\end{subtable} %
    \begin{subtable}[h]{\textwidth}\centering\input{figures4/GZ_Master1/confusion_match_state.tex}\caption{Grévy zebras match-state confusion matrix}\end{subtable} %
\end{table}
}


\newcommand{\EvalMetricsMatch}{
\begin{table}[b]
    \caption[\caplbl{EvalMetricsMatch}Match-state experiment evaluation metrics]{\caplbl{EvalMetricsMatch}
    % ---
    Multiclass match-state evaluation metrics for plains and Grévy's zebras computed from the confusion matrix.
    These metrics demonstrate that our match-state classifiers have strong predictive power.
    %A pair is classified as positive, negative, or incomparable depending on which state has the maximum
    %  probability.
    % ---
    }
    \label{tbl:EvalMetricsMatch}
    \centering
    \begin{subtable}[h]{\textwidth}\centering\input{figures4/PZ_Master1/eval_metrics_match_state.tex}\caption{Plains zebras match-state metrics}\end{subtable} %
    \begin{subtable}[h]{\textwidth}\centering\input{figures4/GZ_Master1/eval_metrics_match_state.tex}\caption{Grévy zebras match-state metrics}\end{subtable} %
\end{table}
}

\begin{comment}
    python -m ibeis.scripts.thesis ExptChapter4.write_metrics --db GZ_Master1 --task-key=photobomb_state
    python -m ibeis.scripts.thesis ExptChapter4.write_metrics --db PZ_Master1 --task-key=photobomb_state
\end{comment}
\newcommand{\ConfusionPhotobomb}{
\begin{table}[h]
    \caption[\caplbl{ConfusionPhotobomb}Photobomb-state experiment confusion matrix]{\caplbl{ConfusionPhotobomb}
    % ---
    The photobomb-state confusion matrix. The columns indicate predicted classes, and the rows indicate real
    (groundtruth) classes.  The final column indicates the number of examples of each class.
    A pair is classified as a photobomb if its probability is greater than $0.5$.
    % ---
    }
    \label{tbl:ConfusionPhotobomb}
    \begin{subtable}[h]{\textwidth}\centering\input{figures4/PZ_Master1/confusion_photobomb_state.tex}\caption{Plains zebra photobomb confusion matrix}\end{subtable} %
    \begin{subtable}[h]{\textwidth}\centering\input{figures4/GZ_Master1/confusion_photobomb_state.tex}\caption{Grévy's zebra photobomb confusion matrix}\end{subtable} %
\end{table}
}


\newcommand{\EvalMetricsPhotobomb}{
\begin{table}[h]
    \caption[\caplbl{EvalMetricsPhotobomb}Photobomb-state experiment evaluation metrics]{\caplbl{EvalMetricsPhotobomb}
    % ---
    The photobomb-state evaluation metrics computed from the confusion matrix.
    A pair is classified as a photobomb if its probability is greater than $0.5$.
    % ---
    }
    \label{tbl:EvalMetricsPhotobomb}
    \centering
    \begin{subtable}[h]{\textwidth}\centering\input{figures4/PZ_Master1/eval_metrics_photobomb_state.tex}\caption{Plains zebras photobomb metrics} \end{subtable} %
    \begin{subtable}[h]{\textwidth}\centering\input{figures4/GZ_Master1/eval_metrics_photobomb_state.tex}\caption{Grévy zebras photobomb metrics}\end{subtable} %
\end{table}
}


\newcommand{\ConfusionPhotobombII}{
\begin{table}[p]
    \caption[\caplbl{ConfusionPhotobombII}Photobomb-state adjusted confusion matrix]{\caplbl{ConfusionPhotobombII} 
    % ---
    The photobomb-state confusion matrix after adjusting the probability threshold to maximize the MCC.
    The columns indicate predicted classes, and the rows indicate real (groundtruth) classes.
    The final column indicates the number of examples of each class.
    % ---
    }
    \label{tbl:ConfusionPhotobombII}
    \begin{subtable}[h]{\textwidth}\centering\input{figures4/PZ_Master1/confusion2_photobomb_state.tex}\caption{Plains zebra photobomb adjusted confusion matrix}\end{subtable} %
    \begin{subtable}[h]{\textwidth}\centering\input{figures4/GZ_Master1/confusion2_photobomb_state.tex}\caption{Grévy's zebra photobomb adjusted confusion matrix}\end{subtable} %
\end{table}
}


\newcommand{\EvalMetricsPhotobombII}{
\begin{table}[p]
    \caption[\caplbl{EvalMetricsPhotobombII}Photobomb-state adjusted evaluation metrics]{\caplbl{EvalMetricsPhotobombII}
    % ---
    The photobomb-state evaluation metrics computed from the confusion matrix after adjusting the probability
      threshold to maximize the MCC.
    % ---
    }
    \label{tbl:EvalMetricsPhotobombII}
    \centering
    \begin{subtable}[h]{\textwidth}\centering\input{figures4/PZ_Master1/eval_metrics2_photobomb_state.tex}\caption{Plains zebras adjusted photobomb metrics} \end{subtable} %
    \begin{subtable}[h]{\textwidth}\centering\input{figures4/GZ_Master1/eval_metrics2_photobomb_state.tex}\caption{Grévy zebras adjusted photobomb metrics}\end{subtable} %
\end{table}
}



\begin{comment}
    python -m ibeis.scripts.script_vsone report_classifier_importance --db PZ_Master1 \
    --dpath ~/latex/crall-thesis-2017/ --save "figures4/wc_pz_clipwhite2.png" \
    --clipwhite --diskshow

    python -m ibeis.scripts.script_vsone report_classifier_importance --db GZ_Master1 \
    --dpath ~/latex/crall-thesis-2017/ --save "figures4/wc_gz_clipwhite2.png" \
    --clipwhite --diskshow
\end{comment}

\newcommand{\MatchWordCloud}{
\begin{figure}[h]
\centering
\begin{subfigure}[h]{0.47\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/wc_match_state.png}\caption{Plains zebra}\label{sub:wc_pz}\end{subfigure}
\begin{subfigure}[h]{0.47\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/wc_match_state.png}\caption{Grévy's zebra}\label{sub:wc_gz}\end{subfigure}
\caption[\caplbl{MatchWordCloud}Word cloud of important features for match-state prediction]{\caplbl{MatchWordCloud}
% ---
Word cloud of important features for predicting match-state.
For plains zebras, the difference in viewpoint (denoted as \pvar{global(view\_delta)}) has high importance
  because of its role in distinguishing incomparable cases.
% ---
}
\label{fig:MatchWordCloud}
\end{figure}
}


\newcommand{\MatchPrune }{
\begin{figure}[h]
\centering
%\begin{subfigure}[h]{0.47\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_PB_RF_TRAIN/wc_match_state.png}\caption{Plains zebra}\label{sub:wc_pz}\end{subfigure}
\begin{subfigure}[h]{0.49\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/prune.png}\caption{Plains zebra}\end{subfigure}
\begin{subfigure}[h]{0.49\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/prune.png}\caption{Grévy's zebra}\end{subfigure}
\caption[\caplbl{MatchPrune}Pruning feature dimensions for match classification]{\caplbl{MatchPrune}
% ---
The effect of pruning the least important feature dimensions on the MCC of the match-state classifier.
We find that a reduced subset of feature dimensions results in a slight increase in classification accuracy over
  the original $131$ features.
However, there is a point at which reducing the number of feature dimensions significantly degrades performance.
% ---
}
\label{fig:MatchPrune}
\end{figure}
}


\newcommand{\ImportantMatchFeat}{
\begin{table}[p]
    \centering
    \caption[\caplbl{ImportantMatchFeat}Important features for match-state prediction]{\caplbl{ImportantMatchFeat} 
    % ---
    Top $10$ most important features for predicting the match-state (positive, negative, incomparable) for a pair
      of annotations.
    The sum of the importance for all $131$ feature dimensions is $1$.
    % ---
    }
    \label{tbl:ImportantMatchFeat}
    \begin{subtable}[h]{1.0\textwidth}
        \centering
        \begin{tabular}{l c}
            \toprule
            dimension & importance\\
            \midrule
            \input{figures4/PZ_Master1/feat_importance_match_state.tex}
            \bottomrule
        \end{tabular}
        \caption{Plains zebra}
    \end{subtable} %
    %~~~~~~~~ 
    \begin{subtable}[h]{1.0\textwidth}
        \centering
        \begin{tabular}{l c}
            \toprule
            dimension & importance\\
            \midrule
            \input{figures4/GZ_Master1/feat_importance_match_state.tex}
            \bottomrule
        \end{tabular}
        \caption{Grévy's zebra}
    \end{subtable} %
\end{table}
}


\newcommand{\ImportantMatchFeatPrune}{
\begin{table}[p]
    \centering
    \caption[\caplbl{ImportantMatchFeatPrune}Important features for match-state prediction]{\caplbl{ImportantMatchFeatPrune} 
    % ---
    Top $10$ most important feature dimensions for predicting the match-state (positive, negative, incomparable)
      for a pair of annotations, after removing the least important dimensions.
    %The sum of the importance for all $131$ feature dimensions is $1$.
    % ---
    }
    \label{tbl:ImportantMatchFeatPrune}
    \begin{subtable}[h]{1.0\textwidth}
        \centering
        \begin{tabular}{l c}
            \toprule
            dimension & importance\\
            \midrule
            \input{figures4/PZ_Master1/pruned_feat_importance_match_state.tex}
            \bottomrule
        \end{tabular}
        \caption{Plains zebra}
    \end{subtable} %
    %~~~~~~~~ 
    \begin{subtable}[h]{1.0\textwidth}
        \centering
        \begin{tabular}{l c}
            \toprule
            dimension & importance\\
            \midrule
            \input{figures4/GZ_Master1/pruned_feat_importance_match_state.tex}
            \bottomrule
        \end{tabular}
        \caption{Grévy's zebra}
    \end{subtable} %
\end{table}
}


\newcommand{\ImportantPBFeat}{
    \begin{table}[h]
        \centering
        \caption[\caplbl{ImportantPBFeat}Important features for photobomb-state prediction]{\caplbl{ImportantPBFeat} 
        % ---
        The top $10$ most important features for predicting if a pair of annotations has a photobomb.
        Features like speed and GPS delta are important because photobombs are more common in pairs of
          annotations taken at the same time and place.
        Features related to the spatial distribution of the feature correspondences are important because
          photobombing animals often appear off to one side of an annotation.
        %they might preclude a match from occurring,
        %  and because annotations taken
        % ---
        }
        \label{tbl:ImportantPBFeat}
        \begin{subtable}[h]{\textwidth} 
            \centering
            \begin{tabular}{l c}
                \toprule dimension & importance\\
                \midrule
                \input{figures4/PZ_Master1/feat_importance_photobomb_state.tex}
                \bottomrule
            \end{tabular}
            \caption{Plains zebra photobomb importance}
        \end{subtable} %
        %~~~~
        \begin{subtable}[h]{\textwidth}
            \centering 
            \begin{tabular}{l c}
                \toprule
                dimension & importance\\ 
                \midrule
                \input{figures4/GZ_Master1/feat_importance_photobomb_state.tex}
                \bottomrule
            \end{tabular}
            \caption{Grévy's zebra photobomb importance}
        \end{subtable} %
    \end{table}
}


% ---------------------
% --- Failure Cases ---
% ---------------------



\newcommand{\PairFailPN}{
\begin{figure}[h]
\centering
\begin{subfigure}[h]{.65\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_match_state/fail_match_nomatch_835_5325.jpg}\end{subfigure}
\begin{subfigure}[h]{.65\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_match_state/fail_match_nomatch_1022_7845.jpg}\end{subfigure}
\begin{subfigure}[h]{.65\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/cases_match_state/fail_match_nomatch_1511_2145.jpg}\end{subfigure}
\begin{subfigure}[h]{.65\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/cases_match_state/fail_match_nomatch_1453_2042.jpg}\end{subfigure}
\caption[\caplbl{PairFailPN}Positive pairwise failure case]{\caplbl{PairFailPN}
% ---
These pairs are all positive, but the match-state classifier predicts each as negative.
These failures can be attributed to poor image quality, occlusion, and viewpoint variations.
Notice that the positive probability is well above zero in all but one case.
%The pair is positive, but the classifier predicts negative because of occlusion and viewpoint variations.
% ---
}
\label{fig:PairFailPN}
\end{figure}
}



\newcommand{\PairFailNP}{
\begin{figure}[h]
\centering
\begin{subfigure}[h]{.7\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_match_state/fail_nomatch_match_2157_2240.jpg}\end{subfigure}
\begin{subfigure}[h]{.7\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_match_state/fail_nomatch_match_3550_5250.jpg}\end{subfigure}
\begin{subfigure}[h]{.7\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/cases_match_state/fail_nomatch_match_1260_2902.jpg}\end{subfigure}
\begin{subfigure}[h]{.7\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/cases_match_state/fail_nomatch_match_1418_1419.jpg}\end{subfigure}
\caption[\caplbl{PairFailNP}Negative pairwise failure case]{\caplbl{PairFailNP}
% ---
These pairs are negative, but the classifier predicts positive.
Notice that the negative probability in each case is not close to zero.
While the classifier can recognize that the matches may be weak, it is not able to explicitly recognize that the
  same region on two animals contains different distinctive patterns.
Photobomb and scenery matches also contribute to negative failure cases.
% ---
}
\label{fig:PairFailNP}
\end{figure}
}


\newcommand{\PairFailIN}{
\begin{figure}[h]
\centering
\begin{subfigure}[h]{.6\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_match_state/fail_notcomp_nomatch_1806_16228.jpg}\end{subfigure}
\begin{subfigure}[h]{.6\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_match_state/fail_notcomp_nomatch_1195_16215.jpg}\end{subfigure}
\begin{subfigure}[h]{.6\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_match_state/fail_notcomp_nomatch_2847_16301.jpg}\end{subfigure}
\begin{subfigure}[h]{.6\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_match_state/fail_notcomp_match_5245_5676.jpg}\end{subfigure}
\caption[\caplbl{PairFailIN}Incomparable pairwise failure case]{\caplbl{PairFailIN}
% ---
These pairs are incomparable, but the classifier predicted either positive or negative.
In part this is due to a small amount of available incomparable training data.
In the top two examples the confidence in the incorrect negative prediction is low.
In the bottom two examples, scenery matches and photobombing animals hinder the classifier's ability to predict
  incomparable.
% ---
}
\label{fig:PairFailIN}
\end{figure}
}

\newcommand{\MatchLabelErrors}{
\begin{figure}[h]
\centering
\begin{subfigure}[h]{.7\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_match_state/fail_notcomp_match_646_1725.jpg}\end{subfigure}
\begin{subfigure}[h]{.7\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_match_state/fail_match_nomatch_4771_4846.jpg}\end{subfigure}
\begin{subfigure}[h]{.7\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/cases_match_state/fail_nomatch_match_1349_3087.jpg}\end{subfigure}
\begin{subfigure}[h]{.7\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/cases_match_state/fail_nomatch_match_1535_2549.jpg}\end{subfigure}
\caption[\caplbl{MatchLabelErrors}Errors in the match-state groundtruth]{\caplbl{MatchLabelErrors}
% ---
Groundtruth errors in the database are the reason for several match-state failure cases.
In these examples the classifier picks the correct answer even though the groundtruth is incorrect.
Note that the probability assigned to the true state of each pair is close to $1.0$.
% ---
}
\label{fig:MatchLabelErrors}
\end{figure}
}


\newcommand{\PhotobombROC}{
\begin{figure}[h]
\centering
\begin{subfigure}[h]{0.47\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/roc_photobomb_state.png}\caption{Plains zebra}\end{subfigure}
\begin{subfigure}[h]{0.47\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/roc_photobomb_state.png}\caption{Grévy's zebra}\end{subfigure}
\caption[\caplbl{PhotobombROC}Photobomb ROC experiment]{\caplbl{PhotobombROC}
% ---
The photobomb-state ROC curve demonstrate that both photobomb-state classifiers
are indeed learning from the data.
% ---
}
\label{fig:PhotobombROC}
\end{figure}
}


\newcommand{\PBThreshMCC}{
\begin{figure}[h]
\centering
\begin{subfigure}[h]{0.47\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/mcc_thresh_photobomb_state.png}\caption{Plains zebra}\end{subfigure}
\begin{subfigure}[h]{0.47\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/mcc_thresh_photobomb_state.png}\caption{Grévy's zebra}\end{subfigure}
\caption[\caplbl{PBThreshMCC}Photobomb ROC experiment]{\caplbl{PhotobombROC}
% ---
Because there are not many labeled photobomb pairs, the probabilities returned by the photobomb-state classifier
  are low.
However, good classification can be achieved by choosing an operating point that maximizes the MCC.
In each plot the legend indicates the threshold corresponding to the maximum MCC.
% ---
}
\label{fig:PBThreshMCC}
\end{figure}
}


\newcommand{\PBFailures}{
\begin{figure}[h]
\centering
\begin{subfigure}[h]{.63\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_photobomb_state/fail_notpb_pb_3844_4160.jpg}\end{subfigure}
\begin{subfigure}[h]{.63\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_photobomb_state/fail_pb_notpb_529_1785.jpg}\end{subfigure}
\begin{subfigure}[h]{.63\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/cases_photobomb_state/fail_pb_notpb_1241_1242.jpg}\end{subfigure}
\begin{subfigure}[h]{.63\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/cases_photobomb_state/fail_pb_notpb_1413_1414.jpg}\end{subfigure}
\caption[\caplbl{PBFailures}Photobomb failure cases]{\caplbl{PBFailures}
% ---
In the top example the classifier incorrectly predicts photobomb due to the alignment of the annotations.
In the next case down, the classifier incorrectly predicts photobomb, but no matches were made between the
  photobombing animals.
The last two cases the classifier incorrectly predicts not photobomb, but confidence of the prediction is low.
% ---
}
\label{fig:PBFailures}
\end{figure}
}



\newcommand{\PBLabelErrors}{
\begin{figure}[h]
\centering
\begin{subfigure}[h]{.75\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_photobomb_state/fail_notpb_pb_1063_1072.jpg}\end{subfigure}
\begin{subfigure}[h]{.75\textwidth}\centering\includegraphics[width=\textwidth]{figures4/PZ_Master1/cases_photobomb_state/fail_notpb_pb_3928_4880.jpg}\end{subfigure}
\begin{subfigure}[h]{.75\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/cases_photobomb_state/fail_notpb_pb_1377_1378.jpg}\end{subfigure}
\begin{subfigure}[h]{.75\textwidth}\centering\includegraphics[width=\textwidth]{figures4/GZ_Master1/cases_photobomb_state/fail_notpb_pb_1184_1185.jpg}\end{subfigure}
\caption[\caplbl{PBLabelErrors}Errors in the photobomb-state groundtruth]{\caplbl{PBLabelErrors}
% ---
Groundtruth errors in the database are the reason for several photobomb-state failure cases.
It is encouraging that the photobomb-state classifier is able to detect errors in the groundtruth even given only
  a few examples of photobomb pairs.
% ---
}
\label{fig:PBLabelErrors}
\end{figure}
}

